// src/App.tsx

import { ThemeProvider, createTheme, CssBaseline, Box, Typography, Button } from '@mui/material';
import { useUserStore } from './store/user.store';
import { MainLayout } from './components/Layout';
import './index.css';

// The theme definition is the same as before
const aegisTheme = createTheme({
  palette: {
    mode: 'dark',
    primary: { main: '#7df9ff' },
    background: { default: '#1a1a1a', paper: '#242424' },
    text: { primary: '#e0e0e0' },
  },
  typography: {
    fontFamily: 'Inter, sans-serif',
    h3: { fontFamily: 'Poppins, sans-serif', fontWeight: 700 },
    h5: { fontFamily: 'Poppins, sans-serif', fontWeight: 600 },
    h6: { fontFamily: 'Poppins, sans-serif', fontWeight: 600 },
  },
});

function App() {
  // We get the login state and the login function from our Zustand store
  const { isLoggedIn, login } = useUserStore();

  // If the user is NOT logged in, we render a simple login page.
  if (!isLoggedIn) {
    return (
      <ThemeProvider theme={aegisTheme}>
        <CssBaseline />
        <Box 
          sx={{ 
            display: 'flex', 
            flexDirection: 'column', 
            alignItems: 'center', 
            justifyContent: 'center', 
            height: '100vh' 
          }}
        >
          <Typography variant="h3" color="primary">Aegis Audit</Typography>
          <Typography sx={{ mb: 4 }}>Please log in to continue.</Typography>
          <Button 
            onClick={() => login('M. Alyousify')} 
            variant="contained" 
            size="large"
          >
            Login
          </Button>
        </Box>
      </ThemeProvider>
    );
  }

  // If the user IS logged in, we render the main application layout.
  return (
    <ThemeProvider theme={aegisTheme}>
      <CssBaseline />
      <MainLayout />
    </ThemeProvider>
  );
}

export default App;